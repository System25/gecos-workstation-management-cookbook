#!/bin/bash
# This script is launched at the login of the user "kiosk"
# to detect its inactivity and restart the session

# Settings
# IDLE_TIME: Idle time before locking, in MINUTES
# LOCK_CMD : program used to lock. Killing session.
# NOTIFY   : notify this many SECONDS before locking.
# NOTIFIER : program used to notify.

IDLE_TIME=<%= @timeout %>
LOCK_CMD="<%= @command %>"
NOTIFY="15" # 15 seconds before locking
NOTIFIER="/usr/bin/zenity --warning --text \"<%= @notification %>\" --timeout 5"

# Print the given message with a timestamp.
info() { printf '%s\t%s\n' "$(date)" "$*"; }

log() {
    if [ -n "${LOCK_LOG:-}" ]; then
        info >>"$LOCK_LOG" "$@"
    else
        info "$@"
    fi
}

xautolock_cmd() {
    log "Launching xautolock ..."
    xautolock -time $IDLE_TIME -locker "$LOCK_CMD" -notify $NOTIFY -notifier "$NOTIFIER > /dev/null 2>&1"
}

# Main
xautolock_cmd
